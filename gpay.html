<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

</body>
<script async src="https://pay.google.com/gp/p/js/pay.js">
</script>
<script>
    /** Launches payment request flow when user taps on buy button. */
    const supportedInstruments = [{
        supportedMethods: ['https://tez.google.com/pay'],
        data: {
            pa: 'merchant-vpa@xxx',
            pn: 'Merchant Name',
            tr: '1234ABCD', // your custom transaction reference ID
            url: 'http://url/of/the/order/in/your/website',
            mc: '1234', // your merchant category code
            tn: 'Purchase in Merchant',
            gstBrkUp: 'GST:16.90|CGST:08.45|SGST:08.45', // GST value break up
            invoiceNo: 'BillRef123', // your invoice number
            invoiceDate: '2019-06-11T13:21:50+05:30', // your invoice date and time
            gstIn: '29ABCDE1234F2Z5', // your GSTIN
        },
    }];
    const details = {
        total: {
            label: 'Total',
            amount: {
                currency: 'INR',
                value: '10.01', // sample amount
            },
        },
        displayItems: [{
            label: 'Original Amount',
            amount: {
                currency: 'INR',
                value: '10.01',
            },
        }],
    };
    let request = null;
    try {
        request = new PaymentRequest(supportedInstruments, details);
    } catch (e) {
        console.log('Payment Request Error: ' + e.message);
        return;
    }
    if (!request) {
        console.log('Web payments are not supported in this browser.');
        return;
    }
    // https://developers.google.com/pay/india/api/web/user-readiness#checking_user_readiness
    // Global key for canMakepayment cache.
    const canMakePaymentCache = 'canMakePaymentCache';

    /**
     * Check whether can make payment with Google Pay or not. It will check session storage
     * cache first and use the cache directly if it exists. Otherwise, it will call
     * canMakePayment method from PaymentRequest object and return the result, the
     * result will also be stored in the session storage cache for future usage.
     *
     * @private
     * @param {PaymentRequest} request The payment request object.
     * @return {Promise} a promise containing the result of whether can make payment.
     */
    function checkCanMakePayment(request) {
        // Check canMakePayment cache, use cache result directly if it exists.
        if (sessionStorage.hasOwnProperty(canMakePaymentCache)) {
            return Promise.resolve(JSON.parse(sessionStorage[canMakePaymentCache]));
        }

        // If canMakePayment() isn't available, default to assume the method is
        // supported.
        var canMakePaymentPromise = Promise.resolve(true);

        // Feature detect canMakePayment().
        if (request.canMakePayment) {
            canMakePaymentPromise = request.canMakePayment();
        }

        return canMakePaymentPromise
            .then((result) => {
                // Store the result in cache for future usage.
                sessionStorage[canMakePaymentCache] = result;
                return result;
            })
            .catch((err) => {
                console.log('Error calling canMakePayment: ' + err);
            });
    }

    function onBuyClicked() {
        if (!window.PaymentRequest) {
            console.log('Web payments are not supported in this browser.');
            return;
        }

        // Create supported payment method.
        const supportedInstruments = [{
            supportedMethods: ['https://tez.google.com/pay'],
            data: {
                pa: 'merchant-vpa@xxx',
                pn: 'Merchant Name',
                tr: '1234ABCD', // Your custom transaction reference ID
                url: 'https://url/of/the/order/in/your/website',
                mc: '1234', //Your merchant category code
                tn: 'Purchase in Merchant',
            },
        }];

        // Create order detail data.
        const details = {
            total: {
                label: 'Total',
                amount: {
                    currency: 'INR',
                    value: '10.01', // sample amount
                },
            },
            displayItems: [{
                label: 'Original Amount',
                amount: {
                    currency: 'INR',
                    value: '10.01',
                },
            }],
        };

        // Create payment request object.
        let request = null;
        try {
            request = new PaymentRequest(supportedInstruments, details);
        } catch (e) {
            console.log('Payment Request Error: ' + e.message);
            return;
        }
        if (!request) {
            console.log('Web payments are not supported in this browser.');
            return;
        }

        var canMakePaymentPromise = checkCanMakePayment(request);
        canMakePaymentPromise
            .then((result) => {
                showPaymentUI(request, result);
            })
            .catch((err) => {
                console.log('Error calling checkCanMakePayment: ' + err);
            });
    }
    // function onGooglePayLoaded() {
    //     const googlePayClient = new google.payments.api.PaymentsClient({
    //         environment: 'TEST'
    //     });
    //     const tokenizationSpec = {
    //         type: 'PAYMENT_GATEWAY',
    //         parameters: {
    //             gateway: 'example',
    //             gatewayMerchantId: 'merchant Id'
    //         }
    //     };
    //     const cardPaymentMethod = {
    //         type: 'CARD',
    //         tokenizationSpecification: tokenizationSpec,
    //         parameters: {
    //             allowedCardNetworks: ['VISA', 'AMEX'],
    //             allowedAuthMethods: ['PAY_ONLY', 'CRYPTOGRAM_3DS'],
    //             billingAddressRequired: true,
    //             billingAddressParameters: {
    //                 format: 'FULL',
    //                 phoneNumberRequired: true
    //             }
    //         }
    //     };
    //     const clientConfiguration = {
    //         apiVersion: 2,
    //         apiVersionMinor: 0,
    //         allowedPaymentMethods: [cardPaymentMethod]
    //     };
    //     googlePayClient.isReadyToPay(clientConfiguration).then(function(response) {
    //         if (response.result) {
    //             // console.log(1);
    //             googlePayClient.createButton({
    //                 buttonColor: 'default',
    //                 buttonType: 'long',
    //                 onClick: onGooglePaymentsButtonClicked
    //             });
    //         }
    //     }).catch(function(err) {
    //         console.log('error');
    //     });

    //     const paymentDataRequest = Object.assign({}, clientConfiguration);
    //     paymentDataRequest.transactionInfo = {
    //         totalPriceStatus: 'FINAL',
    //         totalPrice: '1',
    //         currencyCode: 'INR',
    //     };
    //     paymentDataRequest.merchantInfo = {
    //         merchantId: '0123456789',
    //         merchantName: 'Example Merchant'
    //     };
    //     googlePayClient.loadPaymentData(paymentDataRequest).then(function(paymentData) {
    //         processPayment(paymentData);
    //     }).catch(function(err) {
    //         console.log('error');
    //     });
    // }
</script>

</html>